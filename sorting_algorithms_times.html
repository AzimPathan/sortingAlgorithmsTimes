<!DOCUMENT html>
<html>
    <head>
        <meta charse="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Sortowania</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
        <style>
            tbody tr th,
            tbody tr td:nth-child(4),
            tbody tr td:nth-child(7),
            tbody tr td:nth-child(10){
                border-right: 1px solid white;
            }
        </style>
    </head>
    <body>
        <table class="table table-striped table-dark" id="sorts">
            <thead>
                <tr>
                    <th scope="col">Sorting numbers amount</th>
                </tr>
                <tr>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <div id="curve_chart" style="width: 100%; height: 500px"></div>
        <div id="curve_chart_small" style="width: 100%; height: 500px"></div>

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

        <script sync>
            //Bubble Sort returning Performance Measure
            function perfBubbleSort(items){
                var start = performance.now();
                var length = items.length;
                for(var i = (length-1); i >= 0 ;i--){
                    for(var j = length - i; j > 0 ;j--){
                        if(items[j] < items[j-1]){
                            [items[j], items[j-1]] = [items[j-1], items[j]];
                        }
                    }
                }
                return performance.now() - start;
            }

            //Merge Sort without Performance Measure
            function mergeSort (arr) {
                if (arr.length === 1) {
                    // return once we hit an array with a single item
                    return arr
                }

                const middle = Math.floor(arr.length / 2) // get the middle item of the array rounded down
                const left = arr.slice(0, middle) // items on the left side
                const right = arr.slice(middle) // items on the right side

                return merge(
                    mergeSort(left),
                    mergeSort(right)
                )
            }

            // compare the arrays item by item and return the concatenated result
            function merge (left, right) {
                let result = []
                let indexLeft = 0
                let indexRight = 0

                while (indexLeft < left.length && indexRight < right.length) {
                    if (left[indexLeft] < right[indexRight]) {
                    result.push(left[indexLeft])
                    indexLeft++
                    } else {
                    result.push(right[indexRight])
                    indexRight++
                    }
                }

                return result.concat(left.slice(indexLeft)).concat(right.slice(indexRight))
            }

            //Merge Sort Performance Measure
            function perfMergeSort(items){
                var start = performance.now();   
                score = mergeSort(items);
                //console.log(score);
                return performance.now() - start;
            }

            //QuickSort without performance measure
            function quickSort(items){
                if(items.length <=1) return items;

                var len = items.length;
                var pivotPos = Math.floor(len / 2);
                var pivotVal = items[pivotPos];
                var less = [],
                    more = [],
                    same = [];

                for(var i = 0; i < len ;i++){
                    if(items[i] === pivotVal) same.push(items[i]);
                    else if(items[i] < pivotVal) less.push(items[i]);
                    else more.push(items[i]);
                }
                return quickSort(less).concat(same, quickSort(more));
            }

            //Selection Sort returning Performance Measure
            function perfSelectionSort(items){
                var start = performance.now();                
                var minIdx,
                len = items.length;
                for(var i = 0; i < len; i++){
                    minIdx = i;
                    for(var  j = i+1; j<len; j++){
                        if(items[j]<items[minIdx]){
                            minIdx = j;
                        }
                    }
                    [items[i], items[minIdx]] = [items[minIdx], items[i]];
                }
                return performance.now() - start;
            }
     
            //Return number between 1 and 10 000
            function randomNumber(quantity){
                var table = [];
                for(var x = 0; x <= quantity; x++){
                   table.push(Math.floor((Math.random() * 10000) + 1));
                }
                return table;
            }

            //Quick Sort returning Performance Measure
            function perfQuickSort(items){
                var start = performance.now();   
                score = quickSort(items);
                //console.log(score);
                return performance.now() - start;
            }

            function doPerformanceMeasure(sortingMethodName, quantity){
                var randomTime = performance.now();
                var table = randomNumber(quantity)
                randomTime = performance.now() - randomTime;
                return [window["perf"+sortingMethodName](table), randomTime];
            }

            $(function(){

                //Test Bench
                var sortingMethods = ['BubbleSort','SelectionSort','MergeSort','QuickSort']; //add function name for another sorting method (function name should be like ex:'perfQuickSort' and should return execution time)
                sortingMethods.forEach(function(element) {
                    $('#sorts thead tr:nth-child(1)').append('<th colspan="3" scope="col">'+element+'</th>');
                    $('#sorts thead tr:nth-child(2)').append('<th scope="col">Amount: </th><th scope="col">Sorting time:</th><th scope="col">Randomize time:</th>');
                }, this);

                var averageSort = 0;
                var averageRandom = 0;
                var operations = 0;
                var testPerSort = 100; //increse for more acurrate calculations (also drastically increase execution time)
                var ElapsedTime = 0;
                var charData = new Array();
                charData.push( ['Amount', 'BubbleSort', 'SelectionSort','MergeSort', 'QuickSort']);

                for(var i=5; i<=1000;){
                    var htmlCode = '<tr><th scope="row">'+ i +'</th>';
                    var  subCharData = new Array();
                    subCharData.push(i);    

                    sortingMethods.forEach(function(element) {

                        for(var g=0; g<testPerSort ;g++){
                            test = doPerformanceMeasure(element, i);
                            averageSort +=parseFloat(test[0]);
                            averageRandom +=parseFloat(test[1]);
                            operations++;
                        }

                        ElapsedTime += averageRandom+averageSort;

                        averageSort = averageSort/testPerSort;
                        averageRandom = averageRandom/testPerSort;
                        sum = averageRandom+averageSort;

                        subCharData.push(averageSort); 

                        htmlCode+='<td>'+averageSort+'</td>'+'<td>'+averageRandom+'</td>'+'<td>'+sum+'</td>';

                    }, this);

                    charData.push(subCharData);

                    htmlCode+= '</tr>';
                    $('#sorts tbody').append(htmlCode);

                    if(i<20)i+=5;
                    else if(i<100)i+=20;
                    else i+=100;
                }
                $('#sorts').append('<thead><th>Operations done:</th><th>'+operations+'</th><th>Elapsed time:</th><th>'+ElapsedTime+'</th></th></thead>');

                
                console.log(charData);

                //Google Chart
                google.charts.load('current', {'packages':['corechart']});
                google.charts.setOnLoadCallback(drawChart);

                function drawChart() {
                    var data = google.visualization.arrayToDataTable(charData);

                    var options = {
                    title: 'Sorts Performance 5 to 1000 elements',
                    curveType: 'function',
                    hAxis: {title: 'Amount', minValue: 5}, 
                    vAxis: {title: 'Time', minValue: 0},
                    legend: { position: 'bottom' }
                    };

                    var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

                    chart.draw(data, options);

                    chart = new google.visualization.LineChart(document.getElementById('curve_chart_small'));
                    options = {
                    title: 'Sorts Performance 5 to 100 elements',
                    curveType: 'function',
                    hAxis: {title: 'Amount', minValue: 5}, 
                    vAxis: {title: 'Time', minValue: 0},
                    legend: { position: 'bottom' }
                    };
                    data = google.visualization.arrayToDataTable(charData.slice(0,8));
                    chart.draw(data, options);
                }
                //End Google Chart
            });
        </script>
    </body>
</html>